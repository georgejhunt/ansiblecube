#!/usr/bin/python
import subprocess

def allow_host(ipaddress):

##	Allow host ip to bypass ideascube server

	cmd = "sudo iptables -t nat -I CAPTIVE_PASSLIST 1 -s {ip} -j ACCEPT".format(ip=ipaddress)
	subprocess.check_output(cmd, shell=True)

def application(environ, start_response):
        start_response('200 OK', [('Content-Type', 'text/html')])

## Send HTML redirect to forward user to ideasbox.lan/koombook.lan

        html = """<html><head><meta http-equiv="refresh" content="2; URL='http://{{hostname}}'" />Going to http://{{hostname}}</head></html>"""
        allow_host(environ['REMOTE_ADDR'])
        return html
